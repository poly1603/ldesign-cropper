<!DOCTYPE html>
<html lang="zh-CN">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Cropper ç®€å•ç¤ºä¾‹</title>
  <style>
    * {
      margin: 0;
      padding: 0;
      box-sizing: border-box;
    }

    body {
      font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', sans-serif;
      background: #f5f5f5;
      padding: 20px;
    }

    .container {
      max-width: 1200px;
      margin: 0 auto;
      background: white;
      border-radius: 8px;
      padding: 20px;
      box-shadow: 0 2px 8px rgba(0,0,0,0.1);
    }

    h1 {
      margin-bottom: 20px;
      color: #333;
    }

    .controls {
      margin-bottom: 20px;
      padding: 15px;
      background: #f9f9f9;
      border-radius: 4px;
    }

    .control-group {
      display: flex;
      gap: 10px;
      margin-bottom: 10px;
      flex-wrap: wrap;
    }

    button {
      padding: 8px 16px;
      background: #007bff;
      color: white;
      border: none;
      border-radius: 4px;
      cursor: pointer;
      font-size: 14px;
    }

    button:hover {
      background: #0056b3;
    }

    button:active {
      transform: scale(0.98);
    }

    input[type="file"] {
      padding: 8px;
      border: 1px solid #ddd;
      border-radius: 4px;
    }

    .cropper-container {
      max-width: 100%;
      height: 500px;
      background: #fafafa;
      border: 1px solid #ddd;
      border-radius: 4px;
      overflow: hidden;
    }

    .result {
      margin-top: 20px;
      padding: 15px;
      background: #f9f9f9;
      border-radius: 4px;
    }

    .result h3 {
      margin-bottom: 10px;
      color: #333;
    }

    .result canvas {
      max-width: 100%;
      border: 1px solid #ddd;
      border-radius: 4px;
    }

    .info {
      margin-top: 10px;
      padding: 10px;
      background: #e3f2fd;
      border-left: 3px solid #2196f3;
      font-size: 14px;
      color: #1565c0;
    }
  </style>
</head>
<body>
  <div class="container">
    <h1>ğŸ“· Cropper ç®€å•ä½¿ç”¨ç¤ºä¾‹</h1>
    
    <div class="info">
      è¿™æ˜¯ä¸€ä¸ªç®€æ´çš„Cropperä½¿ç”¨ç¤ºä¾‹ã€‚åªéœ€å¼•å…¥ç¼–è¯‘åçš„åº“æ–‡ä»¶ï¼Œç„¶å new Cropper() å³å¯ä½¿ç”¨ã€‚
    </div>

    <div class="controls">
      <div class="control-group">
        <input type="file" id="fileInput" accept="image/*">
      </div>
      
      <div class="control-group">
        <button onclick="cropper.rotate(45)">â†» æ—‹è½¬45Â°</button>
        <button onclick="cropper.rotate(-45)">â†º æ—‹è½¬-45Â°</button>
        <button onclick="cropper.flipH()">â†” æ°´å¹³ç¿»è½¬</button>
        <button onclick="cropper.flipV()">â†• å‚ç›´ç¿»è½¬</button>
      </div>

      <div class="control-group">
        <button onclick="cropper.zoom(0.1)">ğŸ” æ”¾å¤§</button>
        <button onclick="cropper.zoom(-0.1)">ğŸ” ç¼©å°</button>
        <button onclick="cropper.reset()">ğŸ”„ é‡ç½®</button>
      </div>

      <div class="control-group">
        <button onclick="setAspectRatio(16/9)">16:9</button>
        <button onclick="setAspectRatio(4/3)">4:3</button>
        <button onclick="setAspectRatio(1)">1:1</button>
        <button onclick="setAspectRatio(3/4)">3:4</button>
        <button onclick="setAspectRatio(9/16)">9:16</button>
        <button onclick="setAspectRatio(null)">è‡ªç”±</button>
      </div>

      <div class="control-group">
        <button onclick="getCroppedImage()">âœ‚ï¸ è£å‰ªå¹¶æ˜¾ç¤º</button>
        <button onclick="downloadCroppedImage()">ğŸ’¾ ä¸‹è½½è£å‰ªå›¾ç‰‡</button>
      </div>
    </div>

    <div class="cropper-container">
      <img id="cropperImage" src="https://picsum.photos/1200/800" alt="ç¤ºä¾‹å›¾ç‰‡">
    </div>

    <div class="result" id="resultContainer" style="display: none;">
      <h3>è£å‰ªç»“æœï¼š</h3>
      <canvas id="resultCanvas"></canvas>
    </div>
  </div>

  <!-- å¼•å…¥ç¼–è¯‘åçš„Cropperåº“ -->
  <script type="module">
    // TODO: è¿™é‡Œåº”è¯¥å¼•å…¥ç¼–è¯‘åçš„ cropper.js
    // import Cropper from '../dist/cropper.js';
    
    // ä¸´æ—¶æ–¹æ¡ˆï¼šä»å¼€å‘æœåŠ¡å™¨å¼•å…¥
    import { Cropper } from '../src/index.ts';

    // åˆå§‹åŒ–Cropperï¼ˆå°±è¿™ä¹ˆç®€å•ï¼ï¼‰
    const image = document.getElementById('cropperImage');
    window.cropper = new Cropper(image, {
      aspectRatio: 16 / 9,        // åˆå§‹æ¯”ä¾‹
      viewMode: 1,                 // é™åˆ¶è£å‰ªæ¡†åœ¨canvaså†…
      dragMode: 'move',            // æ‹–åŠ¨æ¨¡å¼
      autoCrop: true,              // è‡ªåŠ¨è£å‰ª
      autoCropArea: 0.8,           // è‡ªåŠ¨è£å‰ªåŒºåŸŸæ¯”ä¾‹
      responsive: true,            // å“åº”å¼
      restore: true,               // æ¢å¤è£å‰ª
      guides: true,                // æ˜¾ç¤ºç½‘æ ¼çº¿
      center: true,                // æ˜¾ç¤ºä¸­å¿ƒæŒ‡ç¤ºå™¨
      highlight: true,             // é«˜äº®è£å‰ªåŒºåŸŸ
      cropBoxMovable: true,        // è£å‰ªæ¡†å¯ç§»åŠ¨
      cropBoxResizable: true,      // è£å‰ªæ¡†å¯è°ƒæ•´å¤§å°
      toggleDragModeOnDblclick: true, // åŒå‡»åˆ‡æ¢æ‹–åŠ¨æ¨¡å¼
      
      // äº‹ä»¶ç›‘å¬
      ready() {
        console.log('Cropper å·²å°±ç»ª');
      },
      cropstart(event) {
        console.log('å¼€å§‹è£å‰ª', event.detail.action);
      },
      cropmove(event) {
        // console.log('è£å‰ªç§»åŠ¨', event.detail.action);
      },
      cropend(event) {
        console.log('è£å‰ªç»“æŸ', event.detail.action);
      },
      crop(event) {
        const data = event.detail;
        console.log('è£å‰ªæ•°æ®:', {
          x: Math.round(data.x),
          y: Math.round(data.y),
          width: Math.round(data.width),
          height: Math.round(data.height),
          rotate: data.rotate,
          scaleX: data.scaleX,
          scaleY: data.scaleY
        });
      },
      zoom(event) {
        console.log('ç¼©æ”¾æ¯”ä¾‹:', event.detail.ratio);
      }
    });

    // æ–‡ä»¶ä¸Šä¼ 
    document.getElementById('fileInput').addEventListener('change', (e) => {
      const file = e.target.files[0];
      if (file && file.type.startsWith('image/')) {
        const reader = new FileReader();
        reader.onload = (event) => {
          cropper.replace(event.target.result);
        };
        reader.readAsDataURL(file);
      }
    });

    // è®¾ç½®çºµæ¨ªæ¯”
    window.setAspectRatio = (ratio) => {
      cropper.setAspectRatio(ratio);
    };

    // è·å–è£å‰ªå›¾ç‰‡
    window.getCroppedImage = () => {
      const canvas = cropper.getCroppedCanvas({
        maxWidth: 2000,
        maxHeight: 2000,
        fillColor: '#fff',
        imageSmoothingEnabled: true,
        imageSmoothingQuality: 'high'
      });

      const resultContainer = document.getElementById('resultContainer');
      const resultCanvas = document.getElementById('resultCanvas');
      
      resultCanvas.width = canvas.width;
      resultCanvas.height = canvas.height;
      const ctx = resultCanvas.getContext('2d');
      ctx.drawImage(canvas, 0, 0);
      
      resultContainer.style.display = 'block';
      resultContainer.scrollIntoView({ behavior: 'smooth' });
    };

    // ä¸‹è½½è£å‰ªå›¾ç‰‡
    window.downloadCroppedImage = () => {
      const canvas = cropper.getCroppedCanvas({
        maxWidth: 4096,
        maxHeight: 4096,
        fillColor: '#fff',
        imageSmoothingEnabled: true,
        imageSmoothingQuality: 'high'
      });

      canvas.toBlob((blob) => {
        const url = URL.createObjectURL(blob);
        const a = document.createElement('a');
        a.href = url;
        a.download = `cropped-${Date.now()}.png`;
        a.click();
        URL.revokeObjectURL(url);
      });
    };

    // æš´éœ²åˆ°å…¨å±€ï¼Œæ–¹ä¾¿è°ƒè¯•
    window.cropper = cropper;
  </script>
</body>
</html>
