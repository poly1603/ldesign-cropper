{"version":3,"file":"Cropper.cjs","sources":["../src/Cropper.tsx"],"sourcesContent":["import React, { useRef, useEffect, useImperativeHandle, forwardRef } from 'react'\r\nimport { Cropper as CropperCore, type CropperOptions } from '@ldesign/cropper-core'\r\nimport type { CropBoxData, CropData } from '@ldesign/cropper-core'\r\nimport '@ldesign/cropper-core/style.css'\r\n\r\nexport interface CropperProps extends CropperOptions {\r\n  onReady?: (event: CustomEvent) => void\r\n  onCropStart?: (event: CustomEvent) => void\r\n  onCropMove?: (event: CustomEvent) => void\r\n  onCropEnd?: (event: CustomEvent) => void\r\n  onCrop?: (event: CustomEvent) => void\r\n  onZoom?: (event: CustomEvent) => void\r\n  style?: React.CSSProperties\r\n  className?: string\r\n}\r\n\r\nexport interface CropperRef {\r\n  getCropper: () => CropperCore | null\r\n  getCropBoxData: () => CropBoxData | null\r\n  setCropBoxData: (data: Partial<CropBoxData>) => void\r\n  getData: (rounded?: boolean) => CropData | null\r\n  getCroppedCanvas: (options?: any) => HTMLCanvasElement | null\r\n  replace: (src: string) => Promise<void>\r\n  reset: () => void\r\n  clear: () => void\r\n  rotate: (degree: number) => void\r\n  scale: (scaleX: number, scaleY?: number) => void\r\n  move: (offsetX: number, offsetY?: number) => void\r\n  zoom: (ratio: number) => void\r\n  enable: () => void\r\n  disable: () => void\r\n  destroy: () => void\r\n}\r\n\r\nexport const Cropper = forwardRef<CropperRef, CropperProps>((props, ref) => {\r\n  const {\r\n    onReady,\r\n    onCropStart,\r\n    onCropMove,\r\n    onCropEnd,\r\n    onCrop,\r\n    onZoom,\r\n    style,\r\n    className,\r\n    ...cropperOptions\r\n  } = props\r\n\r\n  const containerRef = useRef<HTMLDivElement>(null)\r\n  const cropperRef = useRef<CropperCore | null>(null)\r\n\r\n  // 初始化 Cropper\r\n  useEffect(() => {\r\n    if (!containerRef.current) return\r\n\r\n    const options: CropperOptions = {\r\n      ...cropperOptions,\r\n      ready: (e) => {\r\n        onReady?.(e)\r\n        if (cropperOptions.ready) cropperOptions.ready(e)\r\n      },\r\n      cropstart: (e) => {\r\n        onCropStart?.(e)\r\n        if (cropperOptions.cropstart) cropperOptions.cropstart(e)\r\n      },\r\n      cropmove: (e) => {\r\n        onCropMove?.(e)\r\n        if (cropperOptions.cropmove) cropperOptions.cropmove(e)\r\n      },\r\n      cropend: (e) => {\r\n        onCropEnd?.(e)\r\n        if (cropperOptions.cropend) cropperOptions.cropend(e)\r\n      },\r\n      crop: (e) => {\r\n        onCrop?.(e)\r\n        if (cropperOptions.crop) cropperOptions.crop(e)\r\n      },\r\n      zoom: (e) => {\r\n        onZoom?.(e)\r\n        if (cropperOptions.zoom) cropperOptions.zoom(e)\r\n      }\r\n    }\r\n\r\n    cropperRef.current = new CropperCore(containerRef.current, options)\r\n\r\n    return () => {\r\n      cropperRef.current?.destroy()\r\n      cropperRef.current = null\r\n    }\r\n  }, [])\r\n\r\n  // 监听 src 变化\r\n  useEffect(() => {\r\n    if (props.src && cropperRef.current) {\r\n      cropperRef.current.replace(props.src)\r\n    }\r\n  }, [props.src])\r\n\r\n  // 暴露方法\r\n  useImperativeHandle(ref, () => ({\r\n    getCropper: () => cropperRef.current,\r\n    getCropBoxData: () => cropperRef.current?.getCropBoxData() || null,\r\n    setCropBoxData: (data: Partial<CropBoxData>) => {\r\n      cropperRef.current?.setCropBoxData(data)\r\n    },\r\n    getData: (rounded?: boolean) => cropperRef.current?.getData(rounded) || null,\r\n    getCroppedCanvas: (options?: any) => cropperRef.current?.getCroppedCanvas(options) || null,\r\n    replace: async (src: string) => {\r\n      await cropperRef.current?.replace(src)\r\n    },\r\n    reset: () => cropperRef.current?.reset(),\r\n    clear: () => cropperRef.current?.clear(),\r\n    rotate: (degree: number) => cropperRef.current?.rotate(degree),\r\n    scale: (scaleX: number, scaleY?: number) => cropperRef.current?.scale(scaleX, scaleY),\r\n    move: (offsetX: number, offsetY?: number) => cropperRef.current?.move(offsetX, offsetY),\r\n    zoom: (ratio: number) => cropperRef.current?.zoom(ratio),\r\n    enable: () => cropperRef.current?.enable(),\r\n    disable: () => cropperRef.current?.disable(),\r\n    destroy: () => {\r\n      cropperRef.current?.destroy()\r\n      cropperRef.current = null\r\n    }\r\n  }))\r\n\r\n  return (\r\n    <div\r\n      ref={containerRef}\r\n      className={`cropper-container ${className || ''}`}\r\n      style={style}\r\n    />\r\n  )\r\n})\r\n\r\nCropper.displayName = 'Cropper'\r\n\r\nexport default Cropper\r\n\r\n\r\n"],"names":["forwardRef","useRef","useEffect","CropperCore","useImperativeHandle","_jsx"],"mappings":"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"}